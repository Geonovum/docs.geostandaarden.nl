<!DOCTYPE html><html lang="en"><head>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="text/html; charset=utf-8" http-equiv="content-type">
<meta name="generator" content="ReSpec 34.1.4">
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
  
  
  
<title>ADR-HTTP Payload encryption</title>
  
    
  
  
<script>
   respecConfig = {...organisationConfig, ...respecConfig};
  </script>
  
<link href="https://gitdocumentatie.logius.nl/publicatie/respec/style/logos/logius.ico" rel="shortcut icon" type="image/x-icon">
  

<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
:is(h1,h2,h3,h4,h5,h6,a) abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline;position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-.7em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
<style id="respec-nlgov">
img.license{float:left;padding-right:5px}
</style>
<meta name="description" content="This ADR Module contains the requirements for ADR REST-API encryption based on JWE">
<style>
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}
.hljs-comment,.hljs-quote{color:#717277;font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;font-weight:700}
.hljs-literal{color:#0b76c5}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<style>

  .sidelabel {
    position: fixed;
    -webkit-transform-origin: top right;
    right: 100%;
    top: 0;
    -webkit-transform: rotate(-90deg);
    padding: 4px 50px 4px 10px;
    color: white;
    white-space: nowrap;
    z-index: 1;
    background-color: #000000;
  }
</style>
<script type="text/javascript">
   /* Any custom mermaid.js scripts will go here. */
  </script>
<style>

  /* Any custom mermaid.js scripts will go here. */
  }
</style>
<script id="initialUserConfig" type="application/json">{
  "nl_organisationName": "Kennisplatform API's",
  "nl_organisationStylesURL": "https://tools.geostandaarden.nl/respec/style/",
  "nl_organisationPublishURL": "https://docs.geostandaarden.nl/",
  "logos": [
    {
      "src": "https://gitdocumentatie.logius.nl/publicatie/respec/style/logos/figure-logius.svg",
      "alt": "Logius",
      "id": "Logius",
      "height": 77,
      "width": 44,
      "url": "https://www.logius.nl/standaarden"
    }
  ],
  "latestVersion": "https://geonovum.github.io/KP-APIs/API-strategie-modules/encryption/",
  "thisVersion": "https://geonovum.github.io/KP-APIs/API-strategie-modules/encryption/",
  "prevVersion": [
    "nl_organisationPublishURL",
    "pubDomain",
    "/",
    "shortName",
    "/",
    "previousPublishVersion"
  ],
  "isNoTrack": true,
  "useLogo": false,
  "useLabel": true,
  "license": "cc-by",
  "addSectionLinks": true,
  "localizationStrings": {
    "en": {
      "wv": "Draft",
      "cv": "Candidate version",
      "vv": "Proposed version",
      "def": "Definitive version",
      "basis": "Document",
      "eo": "Outdated version",
      "tg": "Rescinded version",
      "no": "Norm",
      "st": "Standard",
      "im": "Information model",
      "pr": "Guideline",
      "hr": "Guide",
      "wa": "Proposed recommendation",
      "al": "General",
      "bd": "Governance documentation",
      "bp": "Best practice"
    },
    "nl": {
      "wv": "Werkversie",
      "cv": "Consultatieversie",
      "vv": "Versie ter vaststelling",
      "def": "Vastgestelde versie",
      "basis": "Document",
      "eo": "Verouderde versie",
      "tg": "Teruggetrokken versie",
      "no": "Norm",
      "st": "Standaard",
      "im": "Informatiemodel",
      "pr": "Praktijkrichtlijn",
      "hr": "Handreiking",
      "wa": "Werkafspraak",
      "al": "Algemeen",
      "bd": "Beheerdocumentatie",
      "bp": "Best practice"
    }
  },
  "sotdText": {
    "nl": {
      "sotd": "Status van dit document",
      "def": "Dit is de definitieve versie van dit document. Wijzigingen naar aanleiding van consultaties zijn doorgevoerd.",
      "wv": "Dit is een werkversie die op elk moment kan worden gewijzigd, verwijderd of vervangen door andere documenten. Het is geen door het TO goedgekeurde consultatieversie.",
      "cv": "Dit is een door het TO goedgekeurde consultatieversie. Commentaar over dit document kan gestuurd worden naar ",
      "vv": "Dit is een definitief concept van de nieuwe versie van dit document. Wijzigingen naar aanleiding van consultaties zijn doorgevoerd.",
      "basis": "Dit is een document zonder officiële status."
    },
    "en": {
      "sotd": "Status of This Document",
      "def": "This is the definitive version of this document. Edits resulting from consultations have been applied.",
      "wv": "This is a draft that could be altered, removed or replaced by other documents. It is not a recommendation approved by TO.",
      "cv": "This is a proposed version approved by the technical commitee. Comments regarding this document may be shared through GitHub: https://github.com/Geonovum/KP-APIs/issues",
      "vv": "This is the definitive concept of this document. Edits resulting from consultations have been applied.",
      "basis": "This document has no official standing."
    }
  },
  "labelColor": {
    "def": "#154273",
    "wv": "#32a852",
    "cv": "#000000",
    "vv": "#000000"
  },
  "licenses": {
    "cc0": {
      "name": "Creative Commons 0 Public Domain Dedication",
      "short": "CC0",
      "url": "https://creativecommons.org/publicdomain/zero/1.0/",
      "image": "https://tools.geostandaarden.nl/respec/style/logos/CC-Licentie.svg"
    },
    "cc-by": {
      "name": "Creative Commons Attribution 4.0 International Public License",
      "short": "CC-BY",
      "url": "https://creativecommons.org/licenses/by/4.0/legalcode",
      "image": "https://tools.geostandaarden.nl/respec/style/logos/cc-by.svg"
    },
    "cc-by-nd": {
      "name": "Creative Commons Naamsvermelding-GeenAfgeleideWerken 4.0 Internationaal",
      "short": "CC-BY-ND",
      "url": "https://creativecommons.org/licenses/by-nd/4.0/legalcode.nl",
      "image": "https://tools.geostandaarden.nl/respec/style/logos/cc-by-nd.svg"
    }
  },
  "localBiblio": {
    "SemVer": {
      "href": "https://semver.org",
      "title": "Semantic Versioning 2.0.0",
      "authors": [
        "T. Preston-Werner"
      ],
      "date": "June 2013"
    },
    "JAdES": {
      "href": "https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf",
      "title": "JAdES digital signatures"
    },
    "HTTP-MessageSig": {
      "href": "https://www.ietf.org/archive/id/draft-ietf-httpbis-message-signatures-14.html",
      "title": "HTTP Message Signatures"
    },
    "ETSI-JADES": {
      "href": "https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/01.01.01_60/ts_11918201v010101p.pdf",
      "title": "JAdES digital signatures"
    },
    "ENISA-CRYPTO-2020": {
      "href": "https://www.enisa.europa.eu/topics/cryptography",
      "title": "ENISA Good Practises in Cryptography – Primitives and Schemes, December 2020. (Limited availability)"
    }
  },
  "specStatus": "CV",
  "specType": "ST",
  "pubDomain": "api",
  "shortName": "encryption",
  "publishDate": "2024-04-17",
  "editors": [
    {
      "name": "Peter Haasnoot",
      "company": "Logius",
      "companyURL": "https://logius.nl"
    }
  ],
  "authors": [
    {
      "name": "KPAPI",
      "company": "KPAPI",
      "companyURL": "https://github.com/Geonovum/KP-APIs"
    }
  ],
  "github": "https://github.com/Geonovum/KP-APIs",
  "postProcess": [
    null
  ]
}</script>
<link rel="stylesheet" href="https://tools.geostandaarden.nl/respec/style/base.css"></head>

<body class="h-entry"><div class="head">
     <h1 id="title" class="title">ADR-HTTP Payload encryption</h1>
    
    <h2>
      Kennisplatform API's Standard<br>
      Candidate version
      <time class="dt-published" datetime="2024-04-17">April 17, 2024</time>
    </h2>
    <dl>
      <dt>This version:</dt><dd class="status">
              <a class="u-url status" href="https://docs.geostandaarden.nl/api/cv-hr-API-Strategie-mod-encryption-20240417/">https://docs.geostandaarden.nl/api/cv-hr-API-Strategie-mod-encryption-20240417/</a>
            </dd>
      <dt>Latest published version:</dt><dd>
              <a href="https://docs.geostandaarden.nl/api/API-Strategie-mod-encryption/">https://docs.geostandaarden.nl/api/API-Strategie-mod-encryption/</a>
            </dd>
      <dt>Latest editor's draft:</dt><dd><a href="https://geonovum.github.io/KP-APIs/API-strategie-modules/encryption/">https://geonovum.github.io/KP-APIs/API-strategie-modules/encryption/</a></dd>
           
      
      
      
      
      <dt>Editor:</dt>
      <dd class="editor p-author h-card vcard">
    <span class="p-name fn">Peter Haasnoot</span> (<a class="p-org org h-org" href="https://logius.nl">Logius</a>)
  </dd>
      
      <dt>Author:</dt><dd class="editor p-author h-card vcard">
    <span class="p-name fn">KPAPI</span> (<a class="p-org org h-org" href="https://github.com/Geonovum/KP-APIs">KPAPI</a>)
  </dd>
      <dt>Participate:</dt><dd>
    <a href="https://github.com/Geonovum/KP-APIs/">GitHub Geonovum/KP-APIs</a>
  </dd><dd>
    <a href="https://github.com/Geonovum/KP-APIs/issues/">File an issue</a>
  </dd><dd>
    <a href="https://github.com/Geonovum/KP-APIs/commits/">Commit history</a>
  </dd><dd>
    <a href="https://github.com/Geonovum/KP-APIs/pulls/">Pull requests</a>
  </dd>
    </dl>
    
    
    
    <p class="copyright">
          This document is licensed under 
          <a rel="license" href="https://creativecommons.org/licenses/by/4.0/legalcode" class="subfoot"><img class="license" src="https://tools.geostandaarden.nl/respec/style/logos/cc-by.svg" alt="Logo Creative Commons Attribution 4.0 International Public License"><br> Creative Commons Attribution 4.0 International Public License</a>
        </p>
    <hr title="Separator for header">
  </div>

  <section id="abstract" class="introductory"><h2>Abstract</h2><p>This ADR Module contains the requirements for ADR REST-API encryption based on JWE</p>
</section>
  <section id="sotd" class="introductory"><h2>Status of This Document</h2><p>This is a proposed version approved by the technical commitee. Comments regarding this document may be shared through GitHub: https://github.com/Geonovum/KP-APIs/issues</p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#adr-http-payload-encryption"><bdi class="secno">1. </bdi>ADR-HTTP Payload encryption</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1.1 </bdi>Introduction</a></li><li class="tocline"><a class="tocxref" href="#notational-conventions"><bdi class="secno">1.2 </bdi>Notational Conventions</a></li><li class="tocline"><a class="tocxref" href="#jwe-encryption"><bdi class="secno">1.3 </bdi>JWE encryption</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#basic-jwe-proces-flow"><bdi class="secno">1.3.1 </bdi>Basic JWE proces flow</a></li><li class="tocline"><a class="tocxref" href="#parameters-and-requirements"><bdi class="secno">1.3.2 </bdi>Parameters and requirements</a></li></ol></li><li class="tocline"><a class="tocxref" href="#cryptographic-algorithms"><bdi class="secno">1.4 </bdi>Cryptographic Algorithms</a></li><li class="tocline"><a class="tocxref" href="#encryption-in-combination-with-signing"><bdi class="secno">1.5 </bdi>Encryption in combination with signing</a></li></ol></li><li class="tocline"><a class="tocxref" href="#tooling"><bdi class="secno">A. </bdi>Tooling</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#jwt-jws-jwe-jwk-and-jwa-implementations"><bdi class="secno">A.1 </bdi>JWT, JWS, JWE, JWK, and JWA Implementations</a></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">B. </bdi>Conformance</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">C. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">C.1 </bdi>Normative references</a></li></ol></li></ol></nav>
  <section id="adr-http-payload-encryption"><div class="header-wrapper"><h2 id="x1-adr-http-payload-encryption"><bdi class="secno">1. </bdi>ADR-HTTP Payload encryption</h2><a class="self-link" href="#adr-http-payload-encryption" aria-label="Permalink for Section 1."></a></div>
<section id="introduction"><div class="header-wrapper"><h3 id="x1-1-introduction"><bdi class="secno">1.1 </bdi>Introduction</h3><a class="self-link" href="#introduction" aria-label="Permalink for Section 1.1"></a></div>
<p>This module specifies the use of JWE for HTTP payload encryption.</p>
<p><strong>Use Cases</strong></p>
<p>This module is applicable when there is a need for end to end message payload confidentiality between client application and server application. 
In a complex IT landscape the path between client and server can go over several intermediary components/systems in which case end to end confidentiality can be especially relevant. (In this case TLS is terminated in each step on the path and does not protect the http-message in transport fully end to end).
A specific example is when there is confidential data that is processed and routed by an intermediary organization which is not allowed to access the contents of the message.</p>
</section><section id="notational-conventions"><div class="header-wrapper"><h3 id="x1-2-notational-conventions"><bdi class="secno">1.2 </bdi>Notational Conventions</h3><a class="self-link" href="#notational-conventions" aria-label="Permalink for Section 1.2"></a></div>
<p>   The key words "<em class="rfc2119">MUST</em>", "<em class="rfc2119">MUST NOT</em>", "<em class="rfc2119">REQUIRED</em>", "<em class="rfc2119">SHALL</em>", "<em class="rfc2119">SHALL NOT</em>",
   "<em class="rfc2119">SHOULD</em>", "<em class="rfc2119">SHOULD NOT</em>", "<em class="rfc2119">RECOMMENDED</em>", "<em class="rfc2119">NOT RECOMMENDED</em>", "<em class="rfc2119">MAY</em>", and
   "<em class="rfc2119">OPTIONAL</em>" in this document are to be interpreted as described in
   "Key words for use in RFCs to Indicate Requirement Levels" [RFC2119].
   The interpretation should only be applied when the terms appear in
   all capital letters.</p>
</section><section id="jwe-encryption"><div class="header-wrapper"><h3 id="x1-3-jwe-encryption"><bdi class="secno">1.3 </bdi>JWE encryption</h3><a class="self-link" href="#jwe-encryption" aria-label="Permalink for Section 1.3"></a></div>
<p> For encryption <a href="https://datatracker.ietf.org/doc/html/rfc7516">JSON Web Encryption (JWE)</a> is used as defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc7516" title="JSON Web Encryption (JWE)">RFC7516</a></cite>];</p>
<section id="basic-jwe-proces-flow"><div class="header-wrapper"><h4 id="x1-3-1-basic-jwe-proces-flow"><bdi class="secno">1.3.1 </bdi>Basic JWE proces flow</h4><a class="self-link" href="#basic-jwe-proces-flow" aria-label="Permalink for Section 1.3.1"></a></div>
<p>The basic flow for encryption using JWE is :</p>
<pre><code class="mermaid hljs" aria-busy="false" data-processed="true"><svg id="mermaid-1715933233164" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="868" style="max-width: 715.34375px;" viewBox="0 0 715.34375 868"><style>
#mermaid-1715933233164 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1715933233164 .error-icon{fill:#552222;}#mermaid-1715933233164 .error-text{fill:#552222;stroke:#552222;}#mermaid-1715933233164 .edge-thickness-normal{stroke-width:2px;}#mermaid-1715933233164 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1715933233164 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1715933233164 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1715933233164 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1715933233164 .marker{fill:#333333;stroke:#333333;}#mermaid-1715933233164 .marker.cross{stroke:#333333;}#mermaid-1715933233164 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1715933233164 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1715933233164 .cluster-label text{fill:#333;}#mermaid-1715933233164 .cluster-label span{color:#333;}#mermaid-1715933233164 .label text,#mermaid-1715933233164 span{fill:#333;color:#333;}#mermaid-1715933233164 .node rect,#mermaid-1715933233164 .node circle,#mermaid-1715933233164 .node ellipse,#mermaid-1715933233164 .node polygon,#mermaid-1715933233164 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1715933233164 .node .label{text-align:center;}#mermaid-1715933233164 .node.clickable{cursor:pointer;}#mermaid-1715933233164 .arrowheadPath{fill:#333333;}#mermaid-1715933233164 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1715933233164 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1715933233164 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1715933233164 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1715933233164 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1715933233164 .cluster text{fill:#333;}#mermaid-1715933233164 .cluster span{color:#333;}#mermaid-1715933233164 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1715933233164 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-1715933233164 .sc&gt;*{fill:#f96!important;}#mermaid-1715933233164 .sc span{fill:#f96!important;}
</style><g><g class="output"><g class="clusters"><g class="cluster" id="flowchart-subGraph1-38" transform="translate(179.953125,434)" style="opacity: 1;"><rect width="343.90625" height="852" x="-171.953125" y="-426"></rect><g class="label" transform="translate(0, -412)" id="mermaid-1715933233164Text"><g transform="translate(-64.0234375,-12)"><foreignObject width="128.046875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Service Requester</div></foreignObject></g></g></g><g class="cluster" id="flowchart-subGraph0-39" transform="translate(539.625,434)" style="opacity: 1;"><rect width="335.4375" height="330" x="-167.71875" y="-165"></rect><g class="label" transform="translate(0, -151)" id="mermaid-1715933233164Text"><g transform="translate(-57.875,-12)"><foreignObject width="115.75" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Service Provider</div></foreignObject></g></g></g></g><g class="edgePaths"><g class="edgePath LS-Request LE-SignA" id="L-Request-SignA" style="opacity: 1;"><path class="path" d="M179.953125,77L179.953125,83.16666666666667C179.953125,89.33333333333333,179.953125,101.66666666666667,179.953125,114C179.953125,126.33333333333333,179.953125,138.66666666666666,179.953125,144.83333333333334L179.953125,151" marker-end="url(#arrowhead100)" style="fill:none"></path><defs><marker id="arrowhead100" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-SignA LE-SignB" id="L-SignA-SignB" style="opacity: 1;"><path class="path" d="M179.953125,195L179.953125,201.16666666666666C179.953125,207.33333333333334,179.953125,219.66666666666666,179.953125,232C179.953125,244.33333333333334,179.953125,256.6666666666667,218.09895833333334,267.81802713700273C256.2447916666667,278.9693876073389,332.5364583333333,288.9387752146777,370.6822916666667,293.92346901834713L408.828125,298.9081628220166" marker-end="url(#arrowhead101)" style="fill:none"></path><defs><marker id="arrowhead101" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-SignB LE-Proc" id="L-SignB-Proc" style="opacity: 1;"><path class="path" d="M539.625,338L539.625,344.1666666666667C539.625,350.3333333333333,539.625,362.6666666666667,539.625,375C539.625,387.3333333333333,539.625,399.6666666666667,539.625,405.8333333333333L539.625,412" marker-end="url(#arrowhead102)" style="fill:none"></path><defs><marker id="arrowhead102" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-Proc LE-SignC" id="L-Proc-SignC" style="opacity: 1;"><path class="path" d="M539.625,456L539.625,462.1666666666667C539.625,468.3333333333333,539.625,480.6666666666667,539.625,493C539.625,505.3333333333333,539.625,517.6666666666666,539.625,523.8333333333334L539.625,530" marker-end="url(#arrowhead103)" style="fill:none"></path><defs><marker id="arrowhead103" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-SignC LE-SignD" id="L-SignC-SignD" style="opacity: 1;"><path class="path" d="M539.625,574L539.625,578.1666666666666C539.625,582.3333333333334,539.625,590.6666666666666,479.6796875,601C419.734375,611.3333333333334,299.84375,623.6666666666666,239.8984375,636C179.953125,648.3333333333334,179.953125,660.6666666666666,179.953125,666.8333333333334L179.953125,673" marker-end="url(#arrowhead104)" style="fill:none"></path><defs><marker id="arrowhead104" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-SignD LE-Response" id="L-SignD-Response" style="opacity: 1;"><path class="path" d="M179.953125,717L179.953125,723.1666666666666C179.953125,729.3333333333334,179.953125,741.6666666666666,179.953125,754C179.953125,766.3333333333334,179.953125,778.6666666666666,179.953125,784.8333333333334L179.953125,791" marker-end="url(#arrowhead105)" style="fill:none"></path><defs><marker id="arrowhead105" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(179.953125,114)" style="opacity: 1;"><g transform="translate(-51.953125,-12)" class="label"><rect rx="0" ry="0" width="103.90625" height="24"></rect><foreignObject width="103.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-Request-SignA" class="edgeLabel L-LS-Request' L-LE-SignA">JSON(payload)</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(179.953125,232)" style="opacity: 1;"><g transform="translate(-72.7421875,-12)" class="label"><rect rx="0" ry="0" width="145.484375" height="24"></rect><foreignObject width="145.484375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-SignA-SignB" class="edgeLabel L-LS-SignA' L-LE-SignB">JWE(JSON(payload))</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(539.625,375)" style="opacity: 1;"><g transform="translate(-51.953125,-12)" class="label"><rect rx="0" ry="0" width="103.90625" height="24"></rect><foreignObject width="103.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-SignB-Proc" class="edgeLabel L-LS-SignB' L-LE-Proc">JSON(payload)</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(539.625,493)" style="opacity: 1;"><g transform="translate(-51.953125,-12)" class="label"><rect rx="0" ry="0" width="103.90625" height="24"></rect><foreignObject width="103.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-Proc-SignC" class="edgeLabel L-LS-Proc' L-LE-SignC">JSON(payload)</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(179.953125,636)" style="opacity: 1;"><g transform="translate(-72.7421875,-12)" class="label"><rect rx="0" ry="0" width="145.484375" height="24"></rect><foreignObject width="145.484375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-SignC-SignD" class="edgeLabel L-LS-SignC' L-LE-SignD">JWE(JSON(payload))</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(179.953125,754)" style="opacity: 1;"><g transform="translate(-51.953125,-12)" class="label"><rect rx="0" ry="0" width="103.90625" height="24"></rect><foreignObject width="103.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-SignD-Response" class="edgeLabel L-LS-SignD' L-LE-Response">JSON(payload)</span></div></foreignObject></g></g></g><g class="nodes"><g class="node sc" id="flowchart-Request-19" transform="translate(179.953125,55)" style="opacity: 1;"><rect rx="0" ry="0" x="-38.296875" y="-22" width="76.59375" height="44" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-28.296875,-12)"><foreignObject width="56.59375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Request</div></foreignObject></g></g></g><g class="node default" id="flowchart-SignA-20" transform="translate(179.953125,173)" style="opacity: 1;"><rect rx="5" ry="5" x="-126.5703125" y="-22" width="253.140625" height="44" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-116.5703125,-12)"><foreignObject width="233.140625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Encrypt with Provider public key</div></foreignObject></g></g></g><g class="node default" id="flowchart-SignD-28" transform="translate(179.953125,695)" style="opacity: 1;"><rect rx="5" ry="5" x="-136.953125" y="-22" width="273.90625" height="44" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-126.953125,-12)"><foreignObject width="253.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Decrypt with Requester private key</div></foreignObject></g></g></g><g class="node sc" id="flowchart-Response-30" transform="translate(179.953125,813)" style="opacity: 1;"><rect rx="0" ry="0" x="-42.65625" y="-22" width="85.3125" height="44" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-32.65625,-12)"><foreignObject width="65.3125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Response</div></foreignObject></g></g></g><g class="node default" id="flowchart-SignB-22" transform="translate(539.625,316)" style="opacity: 1;"><rect rx="5" ry="5" x="-130.796875" y="-22" width="261.59375" height="44" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-120.796875,-12)"><foreignObject width="241.59375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Decrypt with Provider private key</div></foreignObject></g></g></g><g class="node default" id="flowchart-Proc-24" transform="translate(539.625,434)" style="opacity: 1;"><rect rx="5" ry="5" x="-67" y="-22" width="134" height="44" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-57,-12)"><foreignObject width="114" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Process Request</div></foreignObject></g></g></g><g class="node default" id="flowchart-SignC-26" transform="translate(539.625,552)" style="opacity: 1;"><rect rx="5" ry="5" x="-132.71875" y="-22" width="265.4375" height="44" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-122.71875,-12)"><foreignObject width="245.4375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Encrypt with Requester public key</div></foreignObject></g></g></g></g></g></g></svg></code></pre>
<figure id="fig-encryption"><figcaption><a class="self-link" href="#fig-encryption">Figure <bdi class="figno">1</bdi></a> <span class="fig-title">Encryption</span></figcaption></figure>


<ul>
<li><p>1 Service Requester encrypts payload using Service Provider public encryption key:</p>
</li>
<li><p>2 Service Provider decrypts the request using the corresponding Service Provider private encryption key.</p>
</li>
<li><p>3 Service Provider performs the request and then generates an encrypted response;</p>
</li>
<li><p>4 Service Requester decrypts response using Requester private key</p>
</li>
</ul>
</section><section id="parameters-and-requirements"><div class="header-wrapper"><h4 id="x1-3-2-parameters-and-requirements"><bdi class="secno">1.3.2 </bdi>Parameters and requirements</h4><a class="self-link" href="#parameters-and-requirements" aria-label="Permalink for Section 1.3.2"></a></div>
<p>The following specific requirements <em class="rfc2119">MUST</em> be met:</p>
<ul>
<li><p>The request is sent to Service Provider with the content-type: application/jose+json.</p>
</li>
<li><p>An encrypted request needs to pass application/jose+json as the value for the Content-Type and Accept headers:</p>
</li>
</ul>
<pre><code aria-busy="false" class="hljs css"><span class="hljs-attribute">Content</span>-Type: application/jose+json
Accept: application/jose+json
</code></pre>
<ul>
<li><p>When the encrypted request uses an unsupported algorithm, the Service Provider rejects the request with a 400 HTTP response.</p>
</li>
<li><p>Use for encryption the public key from the X.509 certificate of the other party</p>
</li>
<li><p>Use the following parameters in the JWE protected header:</p>
</li>
</ul>
<pre><code aria-busy="false" class="hljs css">alg : <span class="hljs-string">"RSA-OAEP"</span>, 
enc : <span class="hljs-string">"A256GCM"</span>,
typ : <span class="hljs-string">"JWE"</span>
</code></pre>
<ul>
<li>JWE compact serialization format is used</li>
</ul>
</section></section><section id="cryptographic-algorithms"><div class="header-wrapper"><h3 id="x1-4-cryptographic-algorithms"><bdi class="secno">1.4 </bdi>Cryptographic Algorithms</h3><a class="self-link" href="#cryptographic-algorithms" aria-label="Permalink for Section 1.4"></a></div>
<p>The following algorithms are used</p>
<ul>
<li>Key Management : <a href="https://datatracker.ietf.org/doc/html/rfc7518#section-4.3">RSA-OAEP</a></li>
<li>Content encryption : <a href="https://datatracker.ietf.org/doc/html/rfc7518#section-5.3">A256GCM</a></li>
</ul>
<p>As defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc7518" title="JSON Web Algorithms (JWA)">rfc7518</a></cite>] </p>
</section><section id="encryption-in-combination-with-signing"><div class="header-wrapper"><h3 id="x1-5-encryption-in-combination-with-signing"><bdi class="secno">1.5 </bdi>Encryption in combination with signing</h3><a class="self-link" href="#encryption-in-combination-with-signing" aria-label="Permalink for Section 1.5"></a></div>
<p>The following diagram shows the order in which encryption &amp; signing must be applied when encryption is used in combination with signing</p>
<pre><svg id="diagram-1" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="max-width: 810.875px;" viewBox="0 0 810.875 1060"><style>
#diagram-1 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#diagram-1 .error-icon{fill:#552222;}#diagram-1 .error-text{fill:#552222;stroke:#552222;}#diagram-1 .edge-thickness-normal{stroke-width:2px;}#diagram-1 .edge-thickness-thick{stroke-width:3.5px;}#diagram-1 .edge-pattern-solid{stroke-dasharray:0;}#diagram-1 .edge-pattern-dashed{stroke-dasharray:3;}#diagram-1 .edge-pattern-dotted{stroke-dasharray:2;}#diagram-1 .marker{fill:#333333;stroke:#333333;}#diagram-1 .marker.cross{stroke:#333333;}#diagram-1 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#diagram-1 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#diagram-1 .cluster-label text{fill:#333;}#diagram-1 .cluster-label span{color:#333;}#diagram-1 .label text,#diagram-1 span{fill:#333;color:#333;}#diagram-1 .node rect,#diagram-1 .node circle,#diagram-1 .node ellipse,#diagram-1 .node polygon,#diagram-1 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#diagram-1 .node .label{text-align:center;}#diagram-1 .node.clickable{cursor:pointer;}#diagram-1 .arrowheadPath{fill:#333333;}#diagram-1 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#diagram-1 .flowchart-link{stroke:#333333;fill:none;}#diagram-1 .edgeLabel{background-color:#e8e8e8;text-align:center;}#diagram-1 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#diagram-1 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#diagram-1 .cluster text{fill:#333;}#diagram-1 .cluster span{color:#333;}#diagram-1 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#diagram-1 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#diagram-1 .sc&gt;*{fill:#f96!important;}#diagram-1 .sc span{fill:#f96!important;}
</style><g><g class="output"><g class="clusters"><g class="cluster" id="flowchart-subGraph1-118" transform="translate(198.640625,530)" style="opacity: 1;"><rect width="381.28125" height="1044" x="-190.640625" y="-522"></rect><g class="label" transform="translate(0, -508)" id="diagram-1Text"><g transform="translate(-64.0234375,-12)"><foreignObject width="128.046875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Service Requester</div></foreignObject></g></g></g><g class="cluster" id="flowchart-subGraph0-119" transform="translate(606.078125,530)" style="opacity: 1;"><rect width="393.59375" height="426" x="-196.796875" y="-213"></rect><g class="label" transform="translate(0, -199)" id="diagram-1Text"><g transform="translate(-57.875,-12)"><foreignObject width="115.75" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Service Provider</div></foreignObject></g></g></g></g><g class="edgePaths"><g class="edgePath LS-Request LE-SignA" id="L-Request-SignA" style="opacity: 1;"><path class="path" d="M198.640625,77L198.640625,83.16666666666667C198.640625,89.33333333333333,198.640625,101.66666666666667,198.640625,114C198.640625,126.33333333333333,198.640625,138.66666666666666,198.640625,144.83333333333334L198.640625,151" marker-end="url(#arrowhead310)" style="fill:none"></path><defs><marker id="arrowhead310" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-SignA LE-SignB" id="L-SignA-SignB" style="opacity: 1;"><path class="path" d="M198.640625,243L198.640625,249.16666666666666C198.640625,255.33333333333334,198.640625,267.6666666666667,198.640625,280C198.640625,292.3333333333333,198.640625,304.6666666666667,239.58072916666666,317.9675499821036C280.5208333333333,331.2684332975405,362.4010416666667,345.5368665950811,403.3411458333333,352.67108324385134L444.28125,359.8052998926216" marker-end="url(#arrowhead311)" style="fill:none"></path><defs><marker id="arrowhead311" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-SignB LE-Proc" id="L-SignB-Proc" style="opacity: 1;"><path class="path" d="M606.078125,434L606.078125,440.1666666666667C606.078125,446.3333333333333,606.078125,458.6666666666667,606.078125,471C606.078125,483.3333333333333,606.078125,495.6666666666667,606.078125,501.8333333333333L606.078125,508" marker-end="url(#arrowhead312)" style="fill:none"></path><defs><marker id="arrowhead312" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-Proc LE-SignC" id="L-Proc-SignC" style="opacity: 1;"><path class="path" d="M606.078125,552L606.078125,558.1666666666666C606.078125,564.3333333333334,606.078125,576.6666666666666,606.078125,589C606.078125,601.3333333333334,606.078125,613.6666666666666,606.078125,619.8333333333334L606.078125,626" marker-end="url(#arrowhead313)" style="fill:none"></path><defs><marker id="arrowhead313" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-SignC LE-SignD" id="L-SignC-SignD" style="opacity: 1;"><path class="path" d="M606.078125,718L606.078125,722.1666666666666C606.078125,726.3333333333334,606.078125,734.6666666666666,538.171875,745C470.265625,755.3333333333334,334.453125,767.6666666666666,266.546875,780C198.640625,792.3333333333334,198.640625,804.6666666666666,198.640625,810.8333333333334L198.640625,817" marker-end="url(#arrowhead314)" style="fill:none"></path><defs><marker id="arrowhead314" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath LS-SignD LE-Response" id="L-SignD-Response" style="opacity: 1;"><path class="path" d="M198.640625,909L198.640625,915.1666666666666C198.640625,921.3333333333334,198.640625,933.6666666666666,198.640625,946C198.640625,958.3333333333334,198.640625,970.6666666666666,198.640625,976.8333333333334L198.640625,983" marker-end="url(#arrowhead315)" style="fill:none"></path><defs><marker id="arrowhead315" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(198.640625,114)" style="opacity: 1;"><g transform="translate(-51.953125,-12)" class="label"><rect rx="0" ry="0" width="103.90625" height="24"></rect><foreignObject width="103.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-Request-SignA" class="edgeLabel L-LS-Request' L-LE-SignA">JSON(payload)</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(198.640625,280)" style="opacity: 1;"><g transform="translate(-93.09375,-12)" class="label"><rect rx="0" ry="0" width="186.1875" height="24"></rect><foreignObject width="186.1875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-SignA-SignB" class="edgeLabel L-LS-SignA' L-LE-SignB">JWE(JWS(JSON(payload)))</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(606.078125,471)" style="opacity: 1;"><g transform="translate(-51.953125,-12)" class="label"><rect rx="0" ry="0" width="103.90625" height="24"></rect><foreignObject width="103.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-SignB-Proc" class="edgeLabel L-LS-SignB' L-LE-Proc">JSON(payload)</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(606.078125,589)" style="opacity: 1;"><g transform="translate(-51.953125,-12)" class="label"><rect rx="0" ry="0" width="103.90625" height="24"></rect><foreignObject width="103.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-Proc-SignC" class="edgeLabel L-LS-Proc' L-LE-SignC">JSON(payload)</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(198.640625,780)" style="opacity: 1;"><g transform="translate(-93.09375,-12)" class="label"><rect rx="0" ry="0" width="186.1875" height="24"></rect><foreignObject width="186.1875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-SignC-SignD" class="edgeLabel L-LS-SignC' L-LE-SignD">JWS(JWE(JSON(payload)))</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(198.640625,946)" style="opacity: 1;"><g transform="translate(-51.953125,-12)" class="label"><rect rx="0" ry="0" width="103.90625" height="24"></rect><foreignObject width="103.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span id="L-L-SignD-Response" class="edgeLabel L-LS-SignD' L-LE-Response">JSON(payload)</span></div></foreignObject></g></g></g><g class="nodes"><g class="node sc" id="flowchart-Request-99" transform="translate(198.640625,55)" style="opacity: 1;"><rect rx="0" ry="0" x="-38.296875" y="-22" width="76.59375" height="44" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-28.296875,-12)"><foreignObject width="56.59375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Request</div></foreignObject></g></g></g><g class="node default" id="flowchart-SignA-100" transform="translate(198.640625,197)" style="opacity: 1;"><rect rx="5" ry="5" x="-126.5703125" y="-46" width="253.140625" height="92" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-116.5703125,-36)"><foreignObject width="233.140625" height="72"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Sign with Requester private key<br>
    -----------------------<br>
    Encrypt with Provider public key</div></foreignObject></g></g></g><g class="node default" id="flowchart-SignD-108" transform="translate(198.640625,863)" style="opacity: 1;"><rect rx="5" ry="5" x="-155.640625" y="-46" width="311.28125" height="92" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-145.640625,-36)"><foreignObject width="291.28125" height="72"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Decrypt with Requester private key <br>
    -----------------------<br>
    Verify signature with Provider public key</div></foreignObject></g></g></g><g class="node sc" id="flowchart-Response-110" transform="translate(198.640625,1005)" style="opacity: 1;"><rect rx="0" ry="0" x="-42.65625" y="-22" width="85.3125" height="44" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-32.65625,-12)"><foreignObject width="65.3125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Response</div></foreignObject></g></g></g><g class="node default" id="flowchart-SignB-102" transform="translate(606.078125,388)" style="opacity: 1;"><rect rx="5" ry="5" x="-161.796875" y="-46" width="323.59375" height="92" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-151.796875,-36)"><foreignObject width="303.59375" height="72"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Decrypt with Provider private key<br> 
    -----------------------<br>
    Verify signature with Requester public key</div></foreignObject></g></g></g><g class="node default" id="flowchart-Proc-104" transform="translate(606.078125,530)" style="opacity: 1;"><rect rx="5" ry="5" x="-67" y="-22" width="134" height="44" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-57,-12)"><foreignObject width="114" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Process Request</div></foreignObject></g></g></g><g class="node default" id="flowchart-SignC-106" transform="translate(606.078125,672)" style="opacity: 1;"><rect rx="5" ry="5" x="-132.71875" y="-46" width="265.4375" height="92" class="label-container"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-122.71875,-36)"><foreignObject width="245.4375" height="72"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Sign with Provider private key <br>
    -----------------------<br>
    Encrypt with Requester public key</div></foreignObject></g></g></g></g></g></g></svg></pre>
<figure id="fig-signing-encryption"><figcaption><a class="self-link" href="#fig-signing-encryption">Figure <bdi class="figno">2</bdi></a> <span class="fig-title">Signing &amp; Encryption</span></figcaption></figure></section></section>
  <section class="appendix" id="tooling"><div class="header-wrapper"><h2 id="a-tooling"><bdi class="secno">A. </bdi>Tooling</h2><a class="self-link" href="#tooling" aria-label="Permalink for Appendix A."></a></div>
<section id="jwt-jws-jwe-jwk-and-jwa-implementations"><div class="header-wrapper"><h3 id="a-1-jwt-jws-jwe-jwk-and-jwa-implementations"><bdi class="secno">A.1 </bdi>JWT, JWS, JWE, JWK, and JWA Implementations</h3><a class="self-link" href="#jwt-jws-jwe-jwk-and-jwa-implementations" aria-label="Permalink for Appendix A.1"></a></div>
<p> Libraries implementing JWT and the JOSE specs JWS, JWE, JWK, and JWA are listed here.</p>
<p><a href="https://openid.net/developers/jwt-jws-jwe-jwk-and-jwa-implementations/">https://openid.net/developers/jwt-jws-jwe-jwk-and-jwa-implementations/</a></p>
</section></section>
 
  <section id="conformance"><div class="header-wrapper"><h2 id="b-conformance"><bdi class="secno">B. </bdi>Conformance</h2><a class="self-link" href="#conformance" aria-label="Permalink for Section B."></a></div><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p><p>
        The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, <em class="rfc2119">NOT RECOMMENDED</em>, <em class="rfc2119">OPTIONAL</em>, <em class="rfc2119">RECOMMENDED</em>, <em class="rfc2119">REQUIRED</em>, <em class="rfc2119">SHALL</em>, <em class="rfc2119">SHALL NOT</em>, <em class="rfc2119">SHOULD</em>, and <em class="rfc2119">SHOULD NOT</em> in this document
        are to be interpreted as described in
        <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
        when, and only when, they appear in all capitals, as shown here.
      </p></section>
  
  
  
  



<section id="references" class="appendix"><div class="header-wrapper"><h2 id="c-references"><bdi class="secno">C. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix C."></a></div><section id="normative-references">
    <div class="header-wrapper"><h3 id="c-1-normative-references"><bdi class="secno">C.1 </bdi>Normative references</h3><a class="self-link" href="#normative-references" aria-label="Permalink for Appendix C.1"></a></div>
    <dl class="bibliography"><dt id="bib-rfc2119">[RFC2119]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
    </dd><dt id="bib-rfc7516">[RFC7516]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc7516"><cite>JSON Web Encryption (JWE)</cite></a>. M. Jones; J. Hildebrand.  IETF. May 2015. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7516">https://www.rfc-editor.org/rfc/rfc7516</a>
    </dd><dt id="bib-rfc7518">[rfc7518]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc7518"><cite>JSON Web Algorithms (JWA)</cite></a>. M. Jones.  IETF. May 2015. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7518">https://www.rfc-editor.org/rfc/rfc7518</a>
    </dd><dt id="bib-rfc8174">[RFC8174]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><div class="mermaidTooltip" style="opacity: 0;"></div><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><div class="sidelabel">Kennisplatform API's Standard - Candidate version</div><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>